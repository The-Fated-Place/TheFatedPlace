cult = {
	has_target = no
	has_enemies = yes
	expel_members_who_are_targets_of_other_members = no
	has_leader_country = yes
	leader_type = country
	disband_if_no_leader = no
	can_be_enemy_trigger = {
		has_variable = disfavoring_cult
		var:disfavoring_cult = scope:recipient
	}
	unique = no
	land_ownership_rule = cult_land_ownership
	antagonism_modifier_for_taking_land_from_fellow_member = 0.1
	custom_name = cult_name
	can_declare_war = {
		always = yes
	}
	
	create_visible_trigger = {
		always = no
	}

	invite_visible_trigger = {
		religion = {
			has_cults = yes
		}
		trigger_if = {
			limit = {
				exists = scope:recipient
				scope:recipient = {
					exists = var:religion
				}
			}
			OR = {

				AND = {
					religion = religion:imperial_cults
					"scope:recipient.var:religion" = religion:sigmarian_heresy
				}
			}
		}
	}

	modifier = {
		scale = {
            #scaled by the %age of all cult memberships
            value = 0
            every_international_organization = {
                limit = {
					international_organization_type = international_organization_type:cult
				}
                add = total_members
            }
            save_temporary_value_as = total_cult_memberships
			scope:recipient = {
				value = total_members
				if = {
					limit = { scope:total_cult_memberships > 0 }
					divide = scope:total_cult_memberships
				}
			}
		}
        monthly_prestige = 0.1
	}

	modifier = {
		scale = {
            #scaled by the favor
			scope:recipient = {
				value = var:cult_favor
				divide = 1000
			}
		}
        monthly_legitimacy = 0.3

	}

	can_lead_trigger = {
		always = yes
	}

	can_join_trigger = {
		religion = {
			has_cults = yes
		}
		exists = scope:recipient
		NOT = { is_member_of_international_organization = scope:recipient }
		NOT = { is_enemy_of_international_organization = scope:recipient }
		trigger_if = {
			limit = { 
				is_member_of_international_organization_of_type = { type = cult }
			}
			any_international_organizations_member_of = {
				international_organization_type = international_organization_type:cult
				count < prev.religion.max_cults
			}
		}
		trigger_if = {
			limit = {
				scope:recipient = {
					exists = var:religion
				}
			}
			trigger_if = {

				OR = {
					"scope:recipient.var:religion" = religion:imperial_cults
					"scope:recipient.var:religion" = religion:sigmarian_heresy
				}
			}
			trigger_else = {
				OR ={
					AND = {
						religion = religion:imperial_cults
						"scope:recipient.var:religion" = religion:sigmarian_heresy
					}
					religion = "scope:recipient.var:religion"
				}
			}
		}
		OR = {
			any_subject = {
				custom_tooltip = {
					text = join_cult_location_tt
					OR = {
						trigger_if = {
							limit = { country_type = location }
							any_owned_location = {
								scope:recipient = { has_location = prev }
							}
						}
						trigger_if = {
							limit = { country_type = building }
							any_owned_foreign_building_location = {
								scope:recipient = { has_location = prev }
							}
						}
						is_member_of_international_organization = scope:recipient
					}
				}
			}
			any_related_country = {
				type = alliance
				custom_tooltip = {
					text = join_cult_location_tt
					OR = {
						trigger_if = {
							limit = { country_type = location }
							any_owned_location = {
								scope:recipient = { has_location = prev }
							}
						}
						trigger_if = {
							limit = { country_type = building }
							any_owned_foreign_building_location = {
								scope:recipient = { has_location = prev }
							}
						}
						is_member_of_international_organization = scope:recipient
					}
				}
			}
			custom_tooltip = {
				text = join_cult_location_tt
				OR = {
					trigger_if = {
						limit = { country_type = location }
						any_owned_location = {
							scope:recipient = { has_location = prev }
						}
					}
					trigger_if = {
						limit = { country_type = building }
						any_owned_foreign_building_location = {
							scope:recipient = { has_location = prev }
						}
					}
					always = no
				}
			}
		}
	}
	
	can_leave_trigger = {
		scope:recipient = { NOT = { var:cult_favor > 50 } }
		trigger_if = {
			limit = {
				religion = religion:sigmarian_heresy
				scope:recipient = {
					OR = {
						international_organization_has_policy = policy:manaan_policy

					}
				}
			}
			always = no
		}
	}
	
	auto_leave_trigger = {
		always = no
	}

	auto_disband_trigger = {
		always = no
	}

	variables = {
		religion = {
			format = "CULT_RELIGION_FORMAT"
		}
		cult_favor = {
			format = "CULT_FAVOR_DISPLAY"
			change_format = "VARIABLE_CHANGE_FORMAT"
			min = 0
			max = 100
			start = 0
			monthly_change = {
                add = {
                    desc = "MANAAN_PORT_BONUS"
                    if = {
                        limit = {
                            AND = {
                                international_organization_has_policy = policy:manaan_policy
                                culture_group = dwarf_group
                            }
                        }
                        value = 0.05
                    }
                }

				#number of members
				add = {
					desc = "NUMBER_OF_CULT_FOLLOWERS"
					value = total_members
					multiply = 0.075
					divide = 2.5
					subtract = 0.075
				}

                add = {
					desc = "CULT_SUPPORTERS"
					value = 0
					every_in_list = {
						variable = cult_supporters
						add = great_power_score
						multiply = 0.01
					}
				}

                subtract = {
					desc = "CULT_ENEMIES"
					value = 0
					every_international_organization_enemy = {
						add = great_power_score
						multiply = 0.01
					}
				}

				add = {
					desc = "NUM_LOCATIONS"
					value = 0
					every_international_organization_owned_location = {
						add = {
							value = population
							multiply = 0.00002
						}
					}
				}

			}
		}
	}



	on_joined = {
		if = {
			limit = {
				scope:recipient = {
					or = {
						not = { has_variable = religion }
						not = { exists = var:religion }
					}
				}
			}
			#default the religion to that of the leader
			scope:recipient = {
				set_variable = {
					name = religion
					value = root.religion
				}
			}
		}
		scope:recipient = {
			var:religion = {
				add_international_organization = scope:recipient
			}
		}
	}

	on_left = {
	}

	monthly_effect = {
		hidden_effect = {
            random_international_organization_owned_location = {
                #Add locations when high favor
                random_neighbor_location = {
                    limit = {
                        NOT = { is_owned_by_international_organization = root }
                        local_mannan_presence > 0.3
                    }
                    root = { add_location_to_international_organization = prev }
                }
            }
            Remove locations when low favor
            if = {
                limit = {
                    is_owned_by_international_organization = root
                    local_mannan_presence < 0.3
                }
                root = { remove_location_from_international_organization = prev }
            }
        }

		#Auto-join countries when very high favor
		if = {
			limit = { 
				root = { var:cult_favor > 20 }
			}
			every_international_organization_owned_location = {
				if = {
					limit = { 
						has_owner = yes
						owner ?= {
							NOT = { is_member_of_international_organization = root }
							country_can_join_international_organization = root
						}
					}
					root = {
						add_country_to_international_organization = prev.owner
					}
				}
				if = {
					limit = {
						any_foreign_building_countries_in_location ?= {
							NOT = { is_member_of_international_organization = root }
							country_can_join_international_organization = root
						}
					}
					every_foreign_building_countries_in_location = {
						limit = {
							NOT = { is_member_of_international_organization = root }
							country_can_join_international_organization = root
						}
						root = { add_country_to_international_organization = prev }
					}
				}
			}
		}
    }


	
	ai_desire_to_join = {
		#how useful is this branch?
		add = {
			value = "scope:recipient.modifier_utility(scope:actor)"
		}

	}
	
	ai_desire_to_allow_new_member = {
		add = {
			desc = "WE_WANT_THE_ORGANIZATION_TO_GROW"
			value = 20
		}
	}

}